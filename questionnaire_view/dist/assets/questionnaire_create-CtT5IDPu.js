import{d as X,u as Y,j as o,c as J,k as Z,l as ss,a as l,o as n,b as s,f as q,e as d,n as m,t as i,q as N,s as j,x as es,F as ts,h as as,g as C,v as F,m as ls,z as ns,_ as os}from"./index-BuxX1puY.js";import{a as is,b as us}from"./questionnaireModelQuery-CyaAM1O5.js";import{c as x,a as T,b as ds,d as rs,e as cs,f as vs,g as fs,h as ps}from"./questionnaireCreate-Dz9MBAgv.js";const ms={class:"questionnaire-create"},bs={class:"steps-indicator"},gs={key:0,class:"loading-section"},ys={class:"loading-spinner"},_s={key:1,class:"step-content"},ks={class:"content-card"},qs={key:0,class:"empty-section"},Ds={class:"empty-content"},Is={key:1,class:"models-section"},Ss={class:"models-grid"},Cs=["onClick"],xs={class:"model-header"},Ts={key:0,class:"selection-indicator"},Ms={class:"model-content"},hs={class:"model-title"},ws={key:0,class:"model-description"},Qs={class:"model-questions"},Vs={class:"questions-info"},Fs={class:"question-count"},As={class:"model-footer"},Bs={class:"model-id"},Us={class:"step-actions"},Js=["disabled"],Ns={key:2,class:"step-content"},js={class:"content-card"},zs={class:"form-section"},Es={class:"selected-model-info"},Ls={class:"model-summary"},Os={class:"summary-content"},Ps={class:"question-count"},$s={class:"form-group"},Rs={class:"form-group"},Gs={key:0,class:"form-group"},Hs={class:"date-inputs"},Ks={class:"date-input-group"},Ws={class:"date-input-group"},Xs={class:"step-actions"},Ys=["disabled"],Zs={key:0,class:"fas fa-check"},se={key:1,class:"fas fa-spinner fa-spin"},ee={key:3,class:"step-content"},te={class:"content-card success-card"},ae={class:"success-content"},le={class:"success-details"},ne={class:"detail-item"},oe={class:"detail-value"},ie={class:"detail-item"},ue={class:"detail-value"},de={class:"detail-item"},re={class:"detail-value"},ce={class:"detail-item"},ve={class:"success-actions"},fe={class:"message-content"},pe=X({__name:"questionnaire_create",setup(me){const z=ns(),D=Y(),M=o(!1),h=o("正在加载..."),k=o(!1),u=o(1),I=o([]),b=o(null),f=o(null),w=o(""),c=o("draft"),g=o(""),y=o(""),r=o({questionnaireStatus:x(),modelId:"",questionnaireTitle:"",canDelete:0}),S=o(T()),p=o({text:"",type:"success"}),A=J(()=>r.value.modelId!==""&&r.value.questionnaireTitle.trim()!==""&&f.value!==null),E=J(()=>{const t=S.value;return{"status-draft":!t.active&&c.value==="draft","status-active":t.active&&c.value==="active","status-paused":!t.active&&c.value==="paused"}});async function L(){if(!D.isLoggedIn){_("请先登录","error");return}const t=D.userData?.QuestionnaireModel_ids;if(!t||t.length===0){I.value=[];return}M.value=!0,h.value="正在加载您的模版...";try{const e=await is(t);I.value=e}catch(e){console.error("Failed to load models:",e),_("加载模版失败，请稍后重试","error")}finally{M.value=!1}}function B(t){return t?us(t.questionsArray).length:0}function O(t){b.value=t.modelId,f.value=t,r.value.modelId=t.modelId||""}function P(){u.value=1}function $(){if(!b.value){_("请先选择一个模版","error");return}u.value=2}async function R(){if(!A.value){_("请完善所有必填信息","error");return}k.value=!0,h.value="正在创建问卷...";try{const t=await ds(r.value);w.value=t.questionnaireId,D.userData&&D.addQuestionnaireId(t.questionnaireId),u.value=3,_("问卷创建成功！","success")}catch(t){console.error("Failed to create questionnaire:",t);const e=t instanceof Error?t.message:"问卷创建失败";_(e,"error")}finally{k.value=!1}}function G(){u.value=1,b.value=null,f.value=null,w.value="",r.value={questionnaireStatus:x(),modelId:"",questionnaireTitle:"",canDelete:1},S.value=T(),c.value="draft",g.value="",y.value="",V()}function H(){z.push({name:"questionnaire_my"})}function K(t){try{return rs(t).active?"启用":c.value==="draft"?"草稿":"暂停"}catch{return"未知状态"}}function Q(){const t=g.value?new Date(g.value):void 0,e=y.value?new Date(y.value):void 0;let v,a;switch(c.value){case"draft":v=T(),a=x();break;case"active":v=vs(t,e),a=fs(t,e);break;case"paused":v=ps(),a=cs();break;default:v=T(),a=x()}S.value=v,r.value.questionnaireStatus=a}function U(t){return t?new Date(t).toISOString().slice(0,16):""}Z(S,t=>{t.startDate&&(g.value=U(t.startDate)),t.endDate&&(y.value=U(t.endDate))},{deep:!0});function _(t,e){p.value.text=t,p.value.type=e,setTimeout(()=>{V()},3e3)}function V(){p.value.text=""}function W(t){return{success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"}[t]||"fas fa-info-circle"}return ss(()=>{L()}),(t,e)=>{const v=es("router-link");return n(),l("div",ms,[e[43]||(e[43]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-plus-circle"}),d(" 创建问卷 ")]),s("p",{class:"page-description"},"从您的问卷模版中创建新的问卷")],-1)),s("div",bs,[s("div",{class:m(["step",{active:u.value===1,completed:u.value>1}])},[...e[4]||(e[4]=[s("div",{class:"step-number"},"1",-1),s("div",{class:"step-label"},"选择模版",-1)])],2),e[7]||(e[7]=s("div",{class:"step-connector"},null,-1)),s("div",{class:m(["step",{active:u.value===2,completed:u.value>2}])},[...e[5]||(e[5]=[s("div",{class:"step-number"},"2",-1),s("div",{class:"step-label"},"配置问卷",-1)])],2),e[8]||(e[8]=s("div",{class:"step-connector"},null,-1)),s("div",{class:m(["step",{active:u.value===3,completed:u.value>3}])},[...e[6]||(e[6]=[s("div",{class:"step-number"},"3",-1),s("div",{class:"step-label"},"完成创建",-1)])],2)]),M.value?(n(),l("div",gs,[s("div",ys,[e[9]||(e[9]=s("i",{class:"fas fa-spinner fa-spin"},null,-1)),s("p",null,i(h.value),1)])])):u.value===1?(n(),l("div",_s,[s("div",ks,[e[19]||(e[19]=s("div",{class:"section-header"},[s("h2",{class:"section-title"},[s("i",{class:"fas fa-layer-group"}),d(" 选择问卷模版 ")]),s("p",{class:"section-description"},"从您创建的模版中选择一个作为问卷基础")],-1)),I.value.length===0?(n(),l("div",qs,[s("div",Ds,[e[11]||(e[11]=s("i",{class:"fas fa-inbox"},null,-1)),e[12]||(e[12]=s("h3",null,"暂无可用模版",-1)),e[13]||(e[13]=s("p",null,"您还没有创建任何问卷模版",-1)),N(v,{to:{name:"questionnaire_model_create"},class:"btn btn-primary"},{default:j(()=>[...e[10]||(e[10]=[s("i",{class:"fas fa-plus"},null,-1),d(" 立即创建模版 ",-1)])]),_:1})])])):(n(),l("div",Is,[s("div",Ss,[(n(!0),l(ts,null,as(I.value,a=>(n(),l("div",{key:a.modelId,class:m(["model-card",{selected:b.value===a.modelId}]),onClick:be=>O(a)},[s("div",xs,[e[15]||(e[15]=s("div",{class:"model-type-badge"},[s("i",{class:"fas fa-file-alt"}),d(" 问卷模版 ")],-1)),b.value===a.modelId?(n(),l("div",Ts,[...e[14]||(e[14]=[s("i",{class:"fas fa-check-circle"},null,-1)])])):q("",!0)]),s("div",Ms,[s("h3",hs,i(a.modelTitle||"未命名模版"),1),a.modelDesc?(n(),l("p",ws,i(a.modelDesc),1)):q("",!0)]),s("div",Qs,[s("div",Vs,[s("div",Fs,[e[16]||(e[16]=s("i",{class:"fas fa-list-ol"},null,-1)),s("span",null,i(B(a))+" 个问题",1)])])]),s("div",As,[s("span",Bs,"ID: "+i(a.modelId),1)])],10,Cs))),128))]),s("div",Us,[s("button",{onClick:H,class:"btn btn-secondary"},[...e[17]||(e[17]=[s("i",{class:"fas fa-arrow-left"},null,-1),d(" 返回 ",-1)])]),s("button",{onClick:$,class:"btn btn-primary",disabled:!b.value},[...e[18]||(e[18]=[s("i",{class:"fas fa-arrow-right"},null,-1),d(" 下一步 ",-1)])],8,Js)])]))])])):u.value===2?(n(),l("div",Ns,[s("div",js,[e[32]||(e[32]=s("div",{class:"section-header"},[s("h2",{class:"section-title"},[s("i",{class:"fas fa-cog"}),d(" 配置问卷信息 ")]),s("p",{class:"section-description"},"设置问卷的基本信息")],-1)),s("div",zs,[s("div",Es,[e[21]||(e[21]=s("h4",null,"已选择的模版",-1)),s("div",Ls,[s("div",Os,[s("h5",null,i(f.value?.modelTitle||"未命名模版"),1),s("p",null,i(f.value?.modelDesc||"无描述"),1),s("span",Ps,[e[20]||(e[20]=s("i",{class:"fas fa-list-ol"},null,-1)),d(" "+i(B(f.value))+" 个问题 ",1)])])])]),s("div",$s,[e[22]||(e[22]=s("label",{class:"field-label"},[d("问卷标题 "),s("span",{class:"required"},"*")],-1)),C(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.questionnaireTitle=a),type:"text",class:"form-input",placeholder:"请输入问卷标题",maxlength:"100"},null,512),[[F,r.value.questionnaireTitle]]),e[23]||(e[23]=s("p",{class:"field-hint"},"为您的问卷设置一个易于识别的标题",-1))]),s("div",Rs,[e[25]||(e[25]=s("label",{class:"field-label"},"问卷状态",-1)),C(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),onChange:Q,class:"form-select"},[...e[24]||(e[24]=[s("option",{value:"draft"},"草稿 - 未启用",-1),s("option",{value:"active"},"启用 - 可接收回复",-1),s("option",{value:"paused"},"暂停 - 暂时停止接收回复",-1)])],544),[[ls,c.value]]),e[26]||(e[26]=s("p",{class:"field-hint"},"推荐先创建为草稿状态，确认无误后再启用",-1))]),c.value==="active"?(n(),l("div",Gs,[e[29]||(e[29]=s("label",{class:"field-label"},"时间配置 (可选)",-1)),s("div",Hs,[s("div",Ks,[e[27]||(e[27]=s("label",{class:"sub-label"},"开始时间",-1)),C(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),onChange:Q,type:"datetime-local",class:"form-input",placeholder:"选择开始时间"},null,544),[[F,g.value]])]),s("div",Ws,[e[28]||(e[28]=s("label",{class:"sub-label"},"结束时间",-1)),C(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),onChange:Q,type:"datetime-local",class:"form-input",placeholder:"选择结束时间"},null,544),[[F,y.value]])])]),e[30]||(e[30]=s("p",{class:"field-hint"},"留空表示不限制时间范围",-1))])):q("",!0)]),s("div",Xs,[s("button",{onClick:P,class:"btn btn-secondary"},[...e[31]||(e[31]=[s("i",{class:"fas fa-arrow-left"},null,-1),d(" 上一步 ",-1)])]),s("button",{onClick:R,class:"btn btn-primary",disabled:!A.value||k.value},[k.value?(n(),l("i",se)):(n(),l("i",Zs)),d(" "+i(k.value?"创建中...":"创建问卷"),1)],8,Ys)])])])):u.value===3?(n(),l("div",ee,[s("div",te,[s("div",ae,[e[39]||(e[39]=s("div",{class:"success-icon"},[s("i",{class:"fas fa-check-circle"})],-1)),e[40]||(e[40]=s("h2",{class:"success-title"},"问卷创建成功！",-1)),e[41]||(e[41]=s("p",{class:"success-description"},"您的问卷已成功创建并保存",-1)),s("div",le,[s("div",ne,[e[33]||(e[33]=s("label",null,"问卷ID：",-1)),s("span",oe,i(w.value),1)]),s("div",ie,[e[34]||(e[34]=s("label",null,"问卷标题：",-1)),s("span",ue,i(r.value.questionnaireTitle),1)]),s("div",de,[e[35]||(e[35]=s("label",null,"基于模版：",-1)),s("span",re,i(f.value?.modelTitle||"未命名模版"),1)]),s("div",ce,[e[36]||(e[36]=s("label",null,"问卷状态：",-1)),s("span",{class:m(["detail-value status-badge",E.value])},i(K(r.value.questionnaireStatus)),3)])]),s("div",ve,[s("button",{onClick:G,class:"btn btn-secondary"},[...e[37]||(e[37]=[s("i",{class:"fas fa-plus"},null,-1),d(" 再创建一个 ",-1)])]),N(v,{to:{name:"questionnaire_my"},class:"btn btn-primary"},{default:j(()=>[...e[38]||(e[38]=[s("i",{class:"fas fa-list"},null,-1),d(" 查看我的问卷 ",-1)])]),_:1})])])])])):q("",!0),p.value.text?(n(),l("div",{key:4,class:m(["message-container",p.value.type])},[s("div",fe,[s("i",{class:m(W(p.value.type))},null,2),s("span",null,i(p.value.text),1),s("button",{onClick:V,class:"message-close"},[...e[42]||(e[42]=[s("i",{class:"fas fa-times"},null,-1)])])])],2)):q("",!0)])}}}),ke=os(pe,[["__scopeId","data-v-9d222d0f"]]);export{ke as default};
