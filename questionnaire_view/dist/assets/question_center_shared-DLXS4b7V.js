import{B as V,d as j,j as b,r as A,c as I,l as J,a as i,o as a,b as s,f as g,e as f,t as r,F as m,h as q,g as F,v as K,m as P,p as G,n as y,y as p,w as H,z as W,_ as X}from"./index-BuxX1puY.js";import{c as Y}from"./question_create-CQqc0PA0.js";async function Z(){try{console.log("Fetching shared questions...");const o=await V.get("http://localhost:8081/question/get-shared",{timeout:1e4});return console.log("Shared questions response:",{status:o.status,statusText:o.statusText,data:o.data}),o.status===200&&o.data&&Array.isArray(o.data)?o.data:(console.log("No shared questions found or invalid response format"),[])}catch(o){if(console.error("Error fetching shared questions:",o),V.isAxiosError(o)){const u=o.response?.status;console.log("Shared questions fetch error details:",{status:u,message:o.response?.data?.message||o.message})}return[]}}async function ss(o){try{console.log("Referencing shared question:",o);const u=await Y(o.questionType,o.questionOptions,o.questionTitle,o.questionTxt,0);return console.log("Reference question result:",u),u===!0}catch(u){return console.error("Error referencing shared question:",u),!1}}function C(o){try{if(!o||o.trim()==="")return[];const u=JSON.parse(o);return Array.isArray(u)?u:o.split(",").map(d=>d.trim()).filter(d=>d)}catch(u){return console.error("Failed to parse question options:",u),o.split(",").map(d=>d.trim()).filter(d=>d)}}function M(o){return{single:"单选题",multiple:"多选题",text:"文本题",dropdown:"下拉选择题"}[o]||o}function S(o){return{single:"fas fa-dot-circle",multiple:"fas fa-check-square",text:"fas fa-edit",dropdown:"fas fa-caret-down"}[o]||"fas fa-question"}const es={class:"question-center-shared"},ts={class:"stats-section"},os={class:"stats-grid"},ns={class:"stat-card"},is={class:"stat-info"},as={class:"stat-icon"},ls={class:"stat-info"},rs={class:"filter-section"},us={class:"filter-controls"},ds={class:"search-box"},cs={class:"filter-dropdown"},ps=["disabled"],vs={key:0,class:"loading-section"},fs={key:1,class:"empty-section"},ys={class:"empty-content"},hs={key:2,class:"questions-section"},_s={class:"questions-grid"},gs={class:"question-header"},ms={class:"question-type-badge"},qs={class:"question-actions"},ws=["onClick"],bs=["onClick","disabled"],ks={class:"question-content"},xs={class:"question-title"},Ts={key:0,class:"question-description"},Cs={key:1,class:"question-options-preview"},Is={class:"options-list"},Ms={class:"option-index"},Ss={class:"option-text"},Qs={class:"question-footer"},Os={class:"question-id"},Ns={class:"modal-header"},Es={class:"modal-title"},Ls={class:"modal-body"},Vs={class:"preview-question"},As={class:"preview-type-badge"},Fs={class:"preview-title"},$s={key:0,class:"preview-description"},Bs={class:"preview-content"},Ds={key:0,class:"preview-options"},Rs=["name"],zs={key:1,class:"preview-options"},Us={key:2,class:"preview-dropdown"},js={disabled:"",class:"preview-select"},Js={key:3,class:"preview-text"},Ks={class:"modal-footer"},Ps=["disabled"],Gs={class:"message-content"},Hs=j({__name:"question_center_shared",setup(o){const u=W(),d=b(!1),_=b([]),k=b(""),x=b(""),l=b(null),h=A(new Set),v=A({text:"",type:"success"}),$=I(()=>_.value.length),B=I(()=>{const n={};return _.value.forEach(e=>{const t=e.questionType;n[t]=(n[t]||0)+1}),n}),Q=I(()=>{let n=_.value;if(x.value&&(n=n.filter(e=>e.questionType===x.value)),k.value.trim()){const e=k.value.toLowerCase();n=n.filter(t=>t.questionTitle.toLowerCase().includes(e)||t.questionTxt&&t.questionTxt.toLowerCase().includes(e))}return n});async function O(){d.value=!0;try{console.log("Loading shared questions...");const n=await Z();_.value=n,console.log("Loaded shared questions:",n.length)}catch(n){console.error("Failed to load shared questions:",n),w("加载共享问题失败，请稍后重试","error")}finally{d.value=!1}}async function D(){await O(),w("共享问题列表已刷新","success")}function R(n){l.value=n}function T(){l.value=null}async function N(n){if(!h.has(n.questionId))try{h.add(n.questionId),console.log("Referencing question:",n),await ss(n)?(w(`问题 "${n.questionTitle}" 引用成功！您可以在"我的问题"中查看`,"success"),T(),setTimeout(()=>{u.push("/page/question_center_my")},2e3)):w("引用问题失败，请稍后重试","error")}catch(e){console.error("Error referencing question:",e),w("引用问题失败，请稍后重试","error")}finally{h.delete(n.questionId)}}function z(n){return["single","multiple","dropdown"].includes(n)}function w(n,e){v.text=n,v.type=e,setTimeout(()=>{E()},5e3)}function E(){v.text="",v.type="success"}function U(n){return{success:"fas fa-check-circle",error:"fas fa-exclamation-triangle",warning:"fas fa-exclamation-circle",info:"fas fa-info-circle"}[n]||"fas fa-info-circle"}return J(()=>{O()}),(n,e)=>(a(),i("div",es,[e[23]||(e[23]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-share-alt"}),f(" 共享问题中心 ")]),s("p",{class:"page-description"},"发现和引用其他用户共享的问题组件")],-1)),s("div",ts,[s("div",os,[s("div",ns,[e[5]||(e[5]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-share-alt"})],-1)),s("div",is,[s("h3",null,r($.value),1),e[4]||(e[4]=s("p",null,"共享问题总数",-1))])]),(a(!0),i(m,null,q(B.value,(t,c)=>(a(),i("div",{class:"stat-card",key:c},[s("div",as,[s("i",{class:y(p(S)(c))},null,2)]),s("div",ls,[s("h3",null,r(t),1),s("p",null,r(p(M)(c)),1)])]))),128))])]),s("div",rs,[s("div",us,[s("div",ds,[e[6]||(e[6]=s("i",{class:"fas fa-search"},null,-1)),F(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),type:"text",placeholder:"搜索共享问题标题或内容...",class:"search-input"},null,512),[[K,k.value]])]),s("div",cs,[F(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),class:"type-filter"},[...e[7]||(e[7]=[G('<option value="" data-v-b0756d54>全部类型</option><option value="single" data-v-b0756d54>单选题</option><option value="multiple" data-v-b0756d54>多选题</option><option value="text" data-v-b0756d54>文本题</option><option value="dropdown" data-v-b0756d54>下拉选择题</option>',5)])],512),[[P,x.value]])]),s("button",{onClick:D,class:"btn btn-refresh",disabled:d.value},[s("i",{class:y(["fas fa-sync-alt",{"fa-spin":d.value}])},null,2),e[8]||(e[8]=f(" 刷新 ",-1))],8,ps)])]),d.value?(a(),i("div",vs,[...e[9]||(e[9]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-spinner fa-spin"}),s("p",null,"正在加载共享问题...")],-1)])])):Q.value.length===0?(a(),i("div",fs,[s("div",ys,[e[10]||(e[10]=s("i",{class:"fas fa-share-alt"},null,-1)),s("h3",null,r(_.value.length===0?"暂无共享问题":"没有找到匹配的问题"),1),s("p",null,r(_.value.length===0?"还没有用户共享问题组件":"尝试调整搜索条件或筛选器"),1)])])):(a(),i("div",hs,[s("div",_s,[(a(!0),i(m,null,q(Q.value,t=>(a(),i("div",{key:t.questionId,class:"question-card"},[s("div",gs,[s("div",ms,[s("i",{class:y(p(S)(t.questionType))},null,2),f(" "+r(p(M)(t.questionType)),1)]),s("div",qs,[s("button",{onClick:c=>R(t),class:"action-btn preview-btn",title:"预览问题"},[...e[11]||(e[11]=[s("i",{class:"fas fa-eye"},null,-1)])],8,ws),s("button",{onClick:c=>N(t),class:"action-btn reference-btn",title:"引用问题",disabled:h.has(t.questionId)},[s("i",{class:y(["fas fa-copy",{"fa-spin":h.has(t.questionId)}])},null,2)],8,bs)])]),s("div",ks,[s("h3",xs,r(t.questionTitle),1),t.questionTxt?(a(),i("p",Ts,r(t.questionTxt),1)):g("",!0),z(t.questionType)?(a(),i("div",Cs,[e[12]||(e[12]=s("h4",{class:"options-title"},"选项预览:",-1)),s("div",Is,[(a(!0),i(m,null,q(p(C)(t.questionOptions),(c,L)=>(a(),i("div",{key:L,class:"option-item"},[s("span",Ms,r(L+1)+".",1),s("span",Ss,r(c),1)]))),128))])])):g("",!0)]),s("div",Qs,[s("div",Os,[e[13]||(e[13]=s("i",{class:"fas fa-hashtag"},null,-1)),f(" ID: "+r(t.questionId),1)]),e[14]||(e[14]=s("div",{class:"shared-badge"},[s("i",{class:"fas fa-share-alt"}),f(" 共享问题 ")],-1))])]))),128))])])),l.value?(a(),i("div",{key:3,class:"modal-overlay",onClick:T},[s("div",{class:"modal-content",onClick:e[3]||(e[3]=H(()=>{},["stop"]))},[s("div",Ns,[s("h2",Es,[s("i",{class:y(p(S)(l.value.questionType))},null,2),e[15]||(e[15]=f(" 问题预览 ",-1))]),s("button",{onClick:T,class:"modal-close"},[...e[16]||(e[16]=[s("i",{class:"fas fa-times"},null,-1)])])]),s("div",Ls,[s("div",Vs,[s("div",As,r(p(M)(l.value.questionType)),1),s("h3",Fs,r(l.value.questionTitle),1),l.value.questionTxt?(a(),i("p",$s,r(l.value.questionTxt),1)):g("",!0),s("div",Bs,[l.value.questionType==="single"?(a(),i("div",Ds,[(a(!0),i(m,null,q(p(C)(l.value.questionOptions),(t,c)=>(a(),i("div",{key:c,class:"preview-option"},[s("input",{type:"radio",name:`preview-${l.value.questionId}`,disabled:""},null,8,Rs),s("span",null,r(t),1)]))),128))])):l.value.questionType==="multiple"?(a(),i("div",zs,[(a(!0),i(m,null,q(p(C)(l.value.questionOptions),(t,c)=>(a(),i("div",{key:c,class:"preview-option"},[e[17]||(e[17]=s("input",{type:"checkbox",disabled:""},null,-1)),s("span",null,r(t),1)]))),128))])):l.value.questionType==="dropdown"?(a(),i("div",Us,[s("select",js,[e[18]||(e[18]=s("option",null,"请选择...",-1)),(a(!0),i(m,null,q(p(C)(l.value.questionOptions),(t,c)=>(a(),i("option",{key:c},r(t),1))),128))])])):l.value.questionType==="text"?(a(),i("div",Js,[...e[19]||(e[19]=[s("textarea",{placeholder:"请在此输入您的回答...",disabled:"",class:"preview-textarea"},null,-1)])])):g("",!0)])])]),s("div",Ks,[s("button",{onClick:e[2]||(e[2]=t=>N(l.value)),class:"btn btn-primary",disabled:h.has(l.value.questionId)},[s("i",{class:y(["fas fa-copy",{"fa-spin":h.has(l.value.questionId)}])},null,2),e[20]||(e[20]=f(" 引用此问题 ",-1))],8,Ps),s("button",{onClick:T,class:"btn btn-secondary"},[...e[21]||(e[21]=[s("i",{class:"fas fa-times"},null,-1),f(" 关闭 ",-1)])])])])])):g("",!0),v.text?(a(),i("div",{key:4,class:y(["message-container",v.type])},[s("div",Gs,[s("i",{class:y(U(v.type))},null,2),s("span",null,r(v.text),1),s("button",{onClick:E,class:"message-close"},[...e[22]||(e[22]=[s("i",{class:"fas fa-times"},null,-1)])])])],2)):g("",!0)]))}}),Ys=X(Hs,[["__scopeId","data-v-b0756d54"]]);export{Ys as default};
