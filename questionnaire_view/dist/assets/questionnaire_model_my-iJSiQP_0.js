import{A as B,B as I,d as F,u as $,j as h,c as b,k as w,l as N,a as i,o as d,b as s,f as y,e as M,t as n,g as P,v as U,n as V,q as E,s as z,x as j,F as C,h as D,z as K,_ as R}from"./index-BuxX1puY.js";import{g as G,a as H,p as J,b as Q}from"./questionnaireModelQuery-CyaAM1O5.js";async function O(k){try{console.log("Deleting questionnaire model (backend handles all logic):",k);const l=B("authToken");if(!l)throw new Error("未找到认证token");const f=await I.delete(`http://localhost:8081/model/delete/${k}`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});return console.log("Delete model response:",f),f.status===200?{success:!0,message:"模版删除成功"}:{success:!1,message:"删除操作失败"}}catch(l){return console.error("删除问卷模版失败:",l),I.isAxiosError(l)?{success:!1,message:`删除失败: ${l.response?.data?.message||l.response?.data||"服务器错误"}`}:{success:!1,message:"删除操作失败，请稍后重试"}}}const W={class:"questionnaire-model-my"},X={class:"stats-section"},Y={class:"stats-grid"},Z={class:"stat-card"},ss={class:"stat-info"},es={class:"stat-card"},ts={class:"stat-info"},os={class:"stat-card"},ls={class:"stat-info"},ns={class:"filter-section"},as={class:"filter-controls"},is={class:"search-box"},ds=["disabled"],rs={key:0,class:"loading-section"},cs={key:1,class:"empty-section"},us={class:"empty-content"},fs={key:2,class:"models-section"},gs={class:"models-grid"},vs={class:"model-header"},ms={class:"model-actions"},_s=["onClick"],ps=["onClick"],hs={class:"model-content"},ys={class:"model-title"},Ms={key:0,class:"model-description"},ks={class:"model-questions"},qs={class:"questions-info"},Is={class:"question-count"},bs={key:0,class:"questions-preview"},ws={class:"preview-tags"},Cs=["title"],Ds={key:0,class:"more-questions"},Qs={class:"model-footer"},xs={class:"model-id"},Ls={key:3,class:"pagination-section"},As={class:"result-info"},Ts=F({__name:"questionnaire_model_my",setup(k){const l=$(),f=K(),c=h([]),u=h(!1),v=h(""),m=b(()=>G(c.value)),_=b(()=>{let t=c.value;if(v.value.trim()){const e=v.value.toLowerCase().trim();t=t.filter(r=>r.modelTitle&&r.modelTitle.toLowerCase().includes(e)||r.modelDesc&&r.modelDesc.toLowerCase().includes(e))}return t}),q=h(new Map);function p(t){const e=q.value.get(t.modelId);return e?e.length:Q(t.questionsArray).length}function x(t){const e=q.value.get(t.modelId);return e?e.slice(0,3):Q(t.questionsArray).slice(0,3)}async function g(){if(console.log("loadModels called"),console.log("User logged in:",l.isLoggedIn),console.log("User data:",l.userData),!l.isLoggedIn){console.log("User not logged in"),u.value=!1;return}const t=l.userData?.QuestionnaireModel_ids;if(console.log("Model IDs from user data:",t),!t||t.length===0){console.log("No model IDs found in user data"),c.value=[],u.value=!1;return}u.value=!0;try{console.log("Loading models for IDs:",t);const e=await H(t);console.log("Fetched models:",e),c.value=e;const r=e.map(async o=>{try{const a=await J(o.questionsArray);q.value.set(o.modelId,a)}catch(a){console.error("Failed to load questions for model:",o.modelId,a)}});Promise.all(r).then(()=>{console.log("All questions loaded successfully")}).catch(o=>{console.error("Some questions failed to load:",o)}),console.log("Models loaded successfully:",e.length)}catch(e){console.error("Failed to load models:",e),c.value=[]}finally{u.value=!1}}async function L(){await g()}function A(t){console.log("Edit model:",t.modelId),f.push({name:"questionnaire_model_edit",params:{id:t.modelId}})}async function T(t){const e=`确定要删除模版"${t.modelTitle||"未命名模版"}"吗？`;if(confirm(e))try{console.log("Processing delete request for model:",t.modelId);const o=await O(t.modelId);if(o.success)l.removeQuestionnaireModelId(t.modelId),await g(),alert(o.message||"模版删除成功");else{const a=o.message||"操作失败，请稍后重试";alert(a)}}catch(o){console.error("Failed to delete model:",o),alert("操作失败，请稍后重试")}}return w(()=>l.isLoggedIn,t=>{t?g():c.value=[]},{immediate:!0}),w(()=>l.userData?.QuestionnaireModel_ids,()=>{l.isLoggedIn&&g()},{deep:!0}),N(()=>{l.isLoggedIn&&g()}),(t,e)=>{const r=j("router-link");return d(),i("div",W,[e[16]||(e[16]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-file-alt"}),M(" 我的问卷模版 ")]),s("p",{class:"page-description"},"管理您创建的所有问卷模版")],-1)),s("div",X,[s("div",Y,[s("div",Z,[e[2]||(e[2]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-file-alt"})],-1)),s("div",ss,[s("h3",null,n(m.value.totalModels),1),e[1]||(e[1]=s("p",null,"总模版数",-1))])]),s("div",es,[e[4]||(e[4]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-list-ol"})],-1)),s("div",ts,[s("h3",null,n(m.value.totalQuestions),1),e[3]||(e[3]=s("p",null,"总问题数",-1))])]),s("div",os,[e[6]||(e[6]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-calculator"})],-1)),s("div",ls,[s("h3",null,n(m.value.avgQuestionsPerModel),1),e[5]||(e[5]=s("p",null,"平均问题数/模版",-1))])])])]),s("div",ns,[s("div",as,[s("div",is,[e[7]||(e[7]=s("i",{class:"fas fa-search"},null,-1)),P(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),type:"text",placeholder:"搜索模版标题或描述...",class:"search-input"},null,512),[[U,v.value]])]),s("button",{onClick:L,class:"btn btn-refresh",disabled:u.value},[s("i",{class:V(["fas fa-sync-alt",{"fa-spin":u.value}])},null,2),e[8]||(e[8]=M(" 刷新 ",-1))],8,ds)])]),u.value?(d(),i("div",rs,[...e[9]||(e[9]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-spinner fa-spin"}),s("p",null,"正在加载模版列表...")],-1)])])):_.value.length===0?(d(),i("div",cs,[s("div",us,[e[11]||(e[11]=s("i",{class:"fas fa-inbox"},null,-1)),s("h3",null,n(c.value.length===0?"暂无问卷模版":"没有找到匹配的模版"),1),s("p",null,n(c.value.length===0?"您还没有创建任何问卷模版":"尝试调整搜索条件"),1),E(r,{to:{name:"questionnaire_model_create"},class:"btn btn-primary"},{default:z(()=>[...e[10]||(e[10]=[s("i",{class:"fas fa-plus"},null,-1),M(" 创建第一个模版 ",-1)])]),_:1})])])):(d(),i("div",fs,[s("div",gs,[(d(!0),i(C,null,D(_.value,o=>(d(),i("div",{key:o.modelId,class:"model-card"},[s("div",vs,[e[14]||(e[14]=s("div",{class:"model-type-badge"},[s("i",{class:"fas fa-file-alt"}),M(" 问卷模版 ")],-1)),s("div",ms,[s("button",{onClick:a=>A(o),class:"action-btn edit-btn",title:"编辑模版"},[...e[12]||(e[12]=[s("i",{class:"fas fa-edit"},null,-1)])],8,_s),s("button",{onClick:a=>T(o),class:"action-btn delete-btn",title:"删除模版"},[...e[13]||(e[13]=[s("i",{class:"fas fa-trash"},null,-1)])],8,ps)])]),s("div",hs,[s("h3",ys,n(o.modelTitle||"未命名模版"),1),o.modelDesc?(d(),i("p",Ms,n(o.modelDesc),1)):y("",!0)]),s("div",ks,[s("div",qs,[s("div",Is,[e[15]||(e[15]=s("i",{class:"fas fa-list-ol"},null,-1)),s("span",null,n(p(o))+" 个问题",1)]),p(o)>0?(d(),i("div",bs,[s("div",ws,[(d(!0),i(C,null,D(x(o),(a,S)=>(d(),i("span",{key:S,class:"question-tag",title:a.title||"未命名问题"},n((a.title||"未命名问题").length>20?(a.title||"未命名问题").substring(0,20)+"...":a.title||"未命名问题"),9,Cs))),128)),p(o)>3?(d(),i("span",Ds," +"+n(p(o)-3)+"个问题 ",1)):y("",!0)])])):y("",!0)])]),s("div",Qs,[s("span",xs,"ID: "+n(o.modelId),1)])]))),128))])])),_.value.length>0?(d(),i("div",Ls,[s("p",As," 显示 "+n(_.value.length)+" 个模版，共 "+n(m.value.totalModels)+" 个 ",1)])):y("",!0)])}}}),Fs=R(Ts,[["__scopeId","data-v-719d23cf"]]);export{Fs as default};
