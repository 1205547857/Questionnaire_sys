import{A as K,B as D,d as U,u as J,j as y,c as k,k as w,l as O,a as r,o as u,b as s,f as j,e as f,t as o,F as C,h as Q,q as $,s as x,x as P,g as L,v as R,m as G,n as q,y as g,z as H,_ as W}from"./index-BuxX1puY.js";import{g as X,a as Y,b as Z,c as ss,i as S}from"./questionnaireQuery-CABHkqMf.js";async function es(b){try{console.log("Deleting questionnaire (backend handles all logic):",b);const a=K("authToken");if(!a)throw new Error("未找到认证token");const i=await D.delete(`http://localhost:8081/questionnaire/delete/${b}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});return console.log("Delete questionnaire response:",i),i.status===200?(console.log("Questionnaire deleted successfully"),{success:!0,message:"问卷删除成功"}):(console.error("Failed to delete questionnaire:",i),{success:!1,message:"删除失败，请稍后重试"})}catch(a){return console.error("Error deleting questionnaire:",a),D.isAxiosError(a)?{success:!1,message:`删除失败: ${a.response?.data?.message||a.response?.data||"服务器错误"}`}:a instanceof Error?{success:!1,message:`删除失败: ${a.message}`}:{success:!1,message:"删除失败: 未知错误"}}}const ts={class:"questionnaire-my"},ns={class:"stats-section"},as={class:"stats-grid"},is={class:"stat-card"},os={class:"stat-info"},ls={class:"stat-icon"},rs={class:"stat-info"},us={class:"stat-card"},cs={class:"stat-info"},ds={class:"filter-section"},fs={class:"filter-controls"},vs={class:"search-box"},ps={class:"filter-dropdown"},gs=["disabled"],_s={key:0,class:"loading-section"},ms={key:1,class:"empty-section"},hs={class:"empty-content"},ys={key:2,class:"questionnaires-section"},qs={class:"questionnaires-grid"},bs={class:"questionnaire-header"},ks={class:"questionnaire-actions"},Ss=["onClick"],Is=["onClick"],Ds=["onClick"],ws=["onClick","disabled","title"],Cs={class:"questionnaire-content"},Qs={class:"questionnaire-title"},$s={class:"questionnaire-model"},xs={class:"questionnaire-status-details"},Ls={class:"status-info"},Ms={class:"questionnaire-footer"},Ns={class:"questionnaire-id"},Ts={key:3,class:"pagination-section"},Es={class:"result-info"},Vs=U({__name:"questionnaire_my",setup(b){const a=H(),i=J(),c=y([]),v=y(!1),_=y(""),m=y(""),I=k(()=>c.value.length),M=k(()=>{const t={};return c.value.forEach(e=>{try{const n=JSON.parse(e.questionnaireStatus).active?"active":"draft";t[n]=(t[n]||0)+1}catch{}}),t}),h=k(()=>{let t=c.value;if(m.value&&(t=t.filter(e=>{try{return(JSON.parse(e.questionnaireStatus).active?"active":"draft")===m.value}catch{return!1}})),_.value.trim()){const e=_.value.toLowerCase().trim();t=t.filter(l=>l.questionnaireTitle.toLowerCase().includes(e))}return t});async function p(){if(!i.isLoggedIn){console.log("User not logged in");return}const t=i.userData?.questionnaire_ids;if(!t||t.length===0){console.log("No questionnaire IDs found in user data"),c.value=[];return}v.value=!0;try{console.log("Loading questionnaires for IDs:",t);const e=await X(t);c.value=e,console.log("Questionnaires loaded successfully:",e.length)}catch(e){console.error("Failed to load questionnaires:",e)}finally{v.value=!1}}async function N(){await p()}function T(t){console.log("Edit questionnaire:",t.questionnaireId),a.push(`/page/questionnaire_view/${t.questionnaireId}?mode=edit`)}function E(t){console.log("View questionnaire:",t.questionnaireId),a.push(`/page/questionnaire_view/${t.questionnaireId}`)}function V(t){console.log("Analyze questionnaire:",t.questionnaireId),a.push(`/page/questionnaire_analysis/${t.questionnaireId}`)}async function z(t){if(S(t.questionnaireStatus)){alert("无法删除启动中的问卷，请先停用问卷后再删除。");return}const e=`确定要删除问卷"${t.questionnaireTitle}"吗？`;if(confirm(e))try{console.log("Processing delete request for questionnaire:",t.questionnaireId);const n=await es(t.questionnaireId);n.success?(i.removeQuestionnaireId(t.questionnaireId),await p(),alert(n.message||"问卷删除成功")):alert(n.message||"问卷删除失败")}catch(n){console.error("Failed to delete questionnaire:",n),alert("操作失败，请稍后重试")}}function B(t){return{active:"启用中",draft:"草稿"}[t]||t}function A(t){return{active:"fas fa-play-circle",draft:"fas fa-pause-circle"}[t]||"fas fa-question-circle"}function F(t){try{const e=JSON.parse(t);if(e.active){let l="问卷正在运行";if(e.startDate){const n=new Date(e.startDate);l+=` | 开始时间: ${n.toLocaleDateString()}`}if(e.endDate){const n=new Date(e.endDate);l+=` | 结束时间: ${n.toLocaleDateString()}`}return l}else return"问卷处于草稿状态，尚未启用"}catch{return"状态信息无法解析"}}return w(()=>i.isLoggedIn,t=>{t?p():c.value=[]},{immediate:!0}),w(()=>i.userData?.questionnaire_ids,()=>{i.isLoggedIn&&p()},{deep:!0}),O(()=>{i.isLoggedIn&&p()}),(t,e)=>{const l=P("router-link");return u(),r("div",ts,[e[18]||(e[18]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-clipboard-list"}),f(" 我的问卷 ")]),s("p",{class:"page-description"},"管理您创建的所有问卷")],-1)),s("div",ns,[s("div",as,[s("div",is,[e[3]||(e[3]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-clipboard-list"})],-1)),s("div",os,[s("h3",null,o(I.value),1),e[2]||(e[2]=s("p",null,"总问卷数",-1))])]),(u(!0),r(C,null,Q(M.value,(n,d)=>(u(),r("div",{class:"stat-card",key:d},[s("div",ls,[s("i",{class:q(A(d))},null,2)]),s("div",rs,[s("h3",null,o(n),1),s("p",null,o(B(d)),1)])]))),128)),s("div",us,[e[6]||(e[6]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-plus-circle"})],-1)),s("div",cs,[s("h3",null,[$(l,{to:{name:"questionnaire_create"},class:"create-link"},{default:x(()=>[...e[4]||(e[4]=[f(" 创建新问卷 ",-1)])]),_:1})]),e[5]||(e[5]=s("p",null,"开始创建",-1))])])])]),s("div",ds,[s("div",fs,[s("div",vs,[e[7]||(e[7]=s("i",{class:"fas fa-search"},null,-1)),L(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),type:"text",placeholder:"搜索问卷标题...",class:"search-input"},null,512),[[R,_.value]])]),s("div",ps,[L(s("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>m.value=n),class:"status-filter"},[...e[8]||(e[8]=[s("option",{value:""},"全部状态",-1),s("option",{value:"active"},"启用中",-1),s("option",{value:"draft"},"草稿",-1)])],512),[[G,m.value]])]),s("button",{onClick:N,class:"btn btn-refresh",disabled:v.value},[s("i",{class:q(["fas fa-sync-alt",{"fa-spin":v.value}])},null,2),e[9]||(e[9]=f(" 刷新 ",-1))],8,gs)])]),v.value?(u(),r("div",_s,[...e[10]||(e[10]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-spinner fa-spin"}),s("p",null,"正在加载问卷列表...")],-1)])])):h.value.length===0?(u(),r("div",ms,[s("div",hs,[e[12]||(e[12]=s("i",{class:"fas fa-inbox"},null,-1)),s("h3",null,o(c.value.length===0?"暂无问卷":"没有找到匹配的问卷"),1),s("p",null,o(c.value.length===0?"您还没有创建任何问卷":"尝试调整搜索条件或筛选器"),1),$(l,{to:{name:"questionnaire_create"},class:"btn btn-primary"},{default:x(()=>[...e[11]||(e[11]=[s("i",{class:"fas fa-plus"},null,-1),f(" 创建第一个问卷 ",-1)])]),_:1})])])):(u(),r("div",ys,[s("div",qs,[(u(!0),r(C,null,Q(h.value,n=>(u(),r("div",{key:n.questionnaireId,class:"questionnaire-card"},[s("div",bs,[s("div",{class:q(["questionnaire-status-badge",g(Y)(n.questionnaireStatus)])},[s("i",{class:q(g(Z)(n.questionnaireStatus))},null,2),f(" "+o(g(ss)(n.questionnaireStatus)),1)],2),s("div",ks,[s("button",{onClick:d=>T(n),class:"action-btn edit-btn",title:"编辑问卷"},[...e[13]||(e[13]=[s("i",{class:"fas fa-edit"},null,-1)])],8,Ss),s("button",{onClick:d=>E(n),class:"action-btn view-btn",title:"查看问卷"},[...e[14]||(e[14]=[s("i",{class:"fas fa-eye"},null,-1)])],8,Is),s("button",{onClick:d=>V(n),class:"action-btn analyze-btn",title:"数据分析"},[...e[15]||(e[15]=[s("i",{class:"fas fa-chart-bar"},null,-1)])],8,Ds),s("button",{onClick:d=>z(n),class:"action-btn delete-btn",disabled:g(S)(n.questionnaireStatus),title:g(S)(n.questionnaireStatus)?"启动中的问卷无法删除":"删除问卷"},[...e[16]||(e[16]=[s("i",{class:"fas fa-trash"},null,-1)])],8,ws)])]),s("div",Cs,[s("h3",Qs,o(n.questionnaireTitle),1),s("p",$s,[e[17]||(e[17]=s("i",{class:"fas fa-layer-group"},null,-1)),f(" 基于模版ID: "+o(n.modelId),1)])]),s("div",xs,[s("div",Ls,o(F(n.questionnaireStatus)),1)]),s("div",Ms,[s("span",Ns,"ID: "+o(n.questionnaireId),1)])]))),128))])])),h.value.length>0?(u(),r("div",Ts,[s("p",Es," 显示 "+o(h.value.length)+" 个问卷，共 "+o(I.value)+" 个 ",1)])):j("",!0)])}}}),As=W(Vs,[["__scopeId","data-v-250e4969"]]);export{As as default};
