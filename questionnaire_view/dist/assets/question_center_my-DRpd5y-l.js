import{d as F,u as M,j as h,c as k,k as Q,l as U,a as n,o as i,b as s,f as m,e as y,t as l,F as I,h as b,g as w,v as E,m as O,p as z,n as T,q as j,s as K,x as P,y as q,z as R,_ as A}from"./index-BuxX1puY.js";import{getQuestionsByIds as G,getQuestionTypeIcon as C,getQuestionTypeDisplayName as L,parseQuestionOptions as H}from"./questionQuery-D67Y8dOg.js";import{d as J}from"./questionDelete-DSnsLirk.js";const W={class:"question-center-my"},X={class:"stats-section"},Y={class:"stats-grid"},Z={class:"stat-card"},ss={class:"stat-info"},es={class:"stat-icon"},ts={class:"stat-info"},os={class:"filter-section"},ns={class:"filter-controls"},is={class:"search-box"},ls={class:"filter-dropdown"},as=["disabled"],us={key:0,class:"loading-section"},ds={key:1,class:"empty-section"},rs={class:"empty-content"},cs={key:2,class:"questions-section"},ps={class:"questions-grid"},fs={class:"question-header"},vs={class:"question-type-badge"},_s={class:"question-actions"},gs=["onClick"],hs=["onClick"],ms={class:"question-content"},ys={class:"question-title"},qs={key:0,class:"question-description"},ks={key:0,class:"question-options"},Is={class:"options-list"},bs={key:0,class:"option-more"},Ts={class:"question-footer"},xs={class:"question-id"},Qs={key:3,class:"pagination-section"},ws={class:"result-info"},Cs=F({__name:"question_center_my",setup(Ls){const d=M(),D=R(),u=h([]),c=h(!1),f=h(""),v=h(""),x=k(()=>u.value.length),N=k(()=>{const t={};return u.value.forEach(e=>{const a=e.questionType;t[a]=(t[a]||0)+1}),t}),_=k(()=>{let t=u.value;if(v.value&&(t=t.filter(e=>e.questionType===v.value)),f.value.trim()){const e=f.value.toLowerCase().trim();t=t.filter(a=>a.questionTitle.toLowerCase().includes(e)||a.questionTxt&&a.questionTxt.toLowerCase().includes(e))}return t});function g(t){return H(t.questionOptions)}async function p(){if(!d.isLoggedIn){console.log("User not logged in");return}const t=d.userData.question_ids;if(!t||t.length===0){console.log("No question IDs found in user data"),u.value=[];return}c.value=!0;try{console.log("Loading questions for IDs:",t);const e=await G(t);u.value=e,console.log("Questions loaded successfully:",e.length)}catch(e){console.error("Failed to load questions:",e)}finally{c.value=!1}}async function V(){await p()}function S(t){console.log("Edit question:",t.questionId),D.push(`/page/question_center_edit/${t.questionId}`)}async function $(t){const e=`确定要删除问题"${t.questionTitle}"吗？`;if(confirm(e))try{console.log("Processing delete request for question:",t.questionId);const o=await J(t.questionId);o.success?(d.removeQuestionId(t.questionId),await p(),alert(o.message||"问题删除成功")):alert(o.message||"问题删除失败")}catch(o){console.error("Failed to delete question:",o),alert("操作失败，请稍后重试")}}return Q(()=>d.isLoggedIn,t=>{t?p():u.value=[]},{immediate:!0}),Q(()=>d.userData.question_ids,()=>{d.isLoggedIn&&p()},{deep:!0}),U(()=>{d.isLoggedIn&&p()}),(t,e)=>{const a=P("router-link");return i(),n("div",W,[e[13]||(e[13]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},[s("i",{class:"fas fa-list-alt"}),y(" 我的问题组件 ")]),s("p",{class:"page-description"},"管理您创建的所有问题组件")],-1)),s("div",X,[s("div",Y,[s("div",Z,[e[3]||(e[3]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-question-circle"})],-1)),s("div",ss,[s("h3",null,l(x.value),1),e[2]||(e[2]=s("p",null,"总问题数",-1))])]),(i(!0),n(I,null,b(N.value,(o,r)=>(i(),n("div",{class:"stat-card",key:r},[s("div",es,[s("i",{class:T(q(C)(r))},null,2)]),s("div",ts,[s("h3",null,l(o),1),s("p",null,l(q(L)(r)),1)])]))),128))])]),s("div",os,[s("div",ns,[s("div",is,[e[4]||(e[4]=s("i",{class:"fas fa-search"},null,-1)),w(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),type:"text",placeholder:"搜索问题标题或内容...",class:"search-input"},null,512),[[E,f.value]])]),s("div",ls,[w(s("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),class:"type-filter"},[...e[5]||(e[5]=[z('<option value="" data-v-831ef821>全部类型</option><option value="single" data-v-831ef821>单选题</option><option value="multiple" data-v-831ef821>多选题</option><option value="text" data-v-831ef821>文本题</option><option value="dropdown" data-v-831ef821>下拉选择题</option>',5)])],512),[[O,v.value]])]),s("button",{onClick:V,class:"btn btn-refresh",disabled:c.value},[s("i",{class:T(["fas fa-sync-alt",{"fa-spin":c.value}])},null,2),e[6]||(e[6]=y(" 刷新 ",-1))],8,as)])]),c.value?(i(),n("div",us,[...e[7]||(e[7]=[s("div",{class:"loading-spinner"},[s("i",{class:"fas fa-spinner fa-spin"}),s("p",null,"正在加载问题列表...")],-1)])])):_.value.length===0?(i(),n("div",ds,[s("div",rs,[e[9]||(e[9]=s("i",{class:"fas fa-inbox"},null,-1)),s("h3",null,l(u.value.length===0?"暂无问题组件":"没有找到匹配的问题"),1),s("p",null,l(u.value.length===0?"您还没有创建任何问题组件":"尝试调整搜索条件或筛选器"),1),j(a,{to:{name:"question_center_create"},class:"btn btn-primary"},{default:K(()=>[...e[8]||(e[8]=[s("i",{class:"fas fa-plus"},null,-1),y(" 创建第一个问题 ",-1)])]),_:1})])])):(i(),n("div",cs,[s("div",ps,[(i(!0),n(I,null,b(_.value,o=>(i(),n("div",{key:o.questionId,class:"question-card"},[s("div",fs,[s("div",vs,[s("i",{class:T(q(C)(o.questionType))},null,2),y(" "+l(q(L)(o.questionType)),1)]),s("div",_s,[s("button",{onClick:r=>S(o),class:"action-btn edit-btn",title:"编辑问题"},[...e[10]||(e[10]=[s("i",{class:"fas fa-edit"},null,-1)])],8,gs),s("button",{onClick:r=>$(o),class:"action-btn delete-btn",title:"删除问题"},[...e[11]||(e[11]=[s("i",{class:"fas fa-trash"},null,-1)])],8,hs)])]),s("div",ms,[s("h3",ys,l(o.questionTitle),1),o.questionTxt?(i(),n("p",qs,l(o.questionTxt),1)):m("",!0)]),g(o).length>0?(i(),n("div",ks,[e[12]||(e[12]=s("h4",null,"选项：",-1)),s("div",Is,[(i(!0),n(I,null,b(g(o).slice(0,3),(r,B)=>(i(),n("span",{key:B,class:"option-tag"},l(r),1))),128)),g(o).length>3?(i(),n("span",bs," +"+l(g(o).length-3)+"个选项 ",1)):m("",!0)])])):m("",!0),s("div",Ts,[s("span",xs,"ID: "+l(o.questionId),1)])]))),128))])])),_.value.length>0?(i(),n("div",Qs,[s("p",ws," 显示 "+l(_.value.length)+" 个问题，共 "+l(x.value)+" 个 ",1)])):m("",!0)])}}}),Ss=A(Cs,[["__scopeId","data-v-831ef821"]]);export{Ss as default};
